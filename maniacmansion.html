<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>CSV Explorer</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/datatables.net-dt/css/jquery.dataTables.min.css">
  <style>body{font-family:system-ui,Segoe UI,Arial,sans-serif;padding:20px;}</style>
</head>
<body>
  <h1>CSV Explorer</h1>
  <table id="tbl" class="display" style="width:100%"></table>

  <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/datatables.net@2.1.8/js/dataTables.min.js"></script>
  <!-- pako = gzip/deflate in JS -->
  <script src="https://cdn.jsdelivr.net/npm/pako@2.1.0/dist/pako.min.js"></script>

  <script>
    const GZ_URL = "final.csv.gz";  // upload this instead of final.csv

    async function loadCSVFromGzip(url) {
      const res = await fetch(url);
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      const buf = await res.arrayBuffer();
      const uint8 = new Uint8Array(buf);
      // gunzip -> Uint8Array of plain CSV bytes
      const decompressed = window.pako.ungzip(uint8);
      // decode bytes -> string
      const csvText = new TextDecoder("utf-8").decode(decompressed);
      return csvText;
    }

    (async () => {
      const csvText = await loadCSVFromGzip(GZ_URL);

      // Parse from string (no download option needed)
      Papa.parse(csvText, {
        header: true,
        dynamicTyping: true,
        skipEmptyLines: true,
        complete: (res) => {
          const data = res.data.filter(row =>
            Object.values(row).some(v => v !== null && v !== "" && v !== undefined)
          );
          const columns = Object.keys(data[0] || {}).map(k => ({ title: k, data: k }));
          new DataTable('#tbl', {
            data,
            columns,
            paging: true,
            searching: true,
            info: true,
            deferRender: true
          });
        }
      });
    })().catch(err => {
      console.error(err);
      alert("Failed to load CSV: " + err.message);
    });
  </script>
</body>
</html>
